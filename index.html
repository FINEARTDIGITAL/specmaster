<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>가격표(PC-모바일 비교) Tool</title>
  <style>
    body { font-family: 'Apple SD Gothic Neo', sans-serif; background: #f8f9fa; margin:0; }
    .header { text-align:center; font-size:2.1rem; font-weight:700; color:#1a326a; margin-top:38px; margin-bottom:36px; letter-spacing:-2px; }
    .nav { display:flex; justify-content:center; gap:2px; border-bottom:2px solid #e2e6f2; margin-bottom:32px; background:#f8f9fa; }
    .nav-btn {
      font-size:1.15em; font-weight:600; border:none; background:none; padding:12px 60px 13px 60px; 
      cursor:pointer; color:#789; border-radius:14px 14px 0 0;
      transition:all .13s; outline:none; margin:0 1px;
    }
    .nav-btn.active { background:#fff; color:#2351a5; border:1.5px solid #d4d9ee; border-bottom:none; }
    .tab-content { display:none; }
    .tab-content.active { display:block; }
    .tab-section { padding:0 0 44px 0; max-width:1200px; margin:0 auto;}
    .upload-wrap {margin-bottom:16px;}
    .result-row { display: flex; gap: 38px; }
    .result-box {
      flex: 1; background: #fff; border: 1.5px solid #d3d7e4;
      border-radius: 16px; white-space: pre-wrap; position: relative;
      min-width: 330px; box-shadow:0 2px 13px #bcc5df26; padding: 26px 18px 28px 24px;
      margin-top:0; margin-bottom:0;
      display:flex; flex-direction:column; align-items:stretch;
    }
    .result-box h3 {
      font-size:1.16em; font-weight:600; color:#2456b1; margin:0 0 11px 0;
    }
    .compare-row {margin-top:28px;}
    .copy-btn {
      position: absolute; top: 22px; right: 22px;
      background:#276beb; color:#fff; border:none; border-radius:7px;
      padding: 7px 20px; font-size:1em; cursor:pointer; box-shadow:0 2px 8px #2563eb22; font-weight:500;
      transition:background .13s;
    }
    .copy-btn:hover { background:#174ac2; }
    .extract-btn {
      padding: 8px 24px; background: #2563eb; color: white; border: none; border-radius: 6px;
      font-size:1.07em; font-weight:600; cursor: pointer; box-shadow:0 2px 8px #2563eb14; margin-bottom:10px;
      margin-left:10px;
    }
    .extract-btn:disabled {background:#a5b6d9; color:#fff; cursor:not-allowed;}
    .compare-title {font-size:1.16em; font-weight:600; color:#2456b1; margin:0 0 13px 0;}
    .diff {color:#e13939;font-weight:700;}
    .plus {color:#2352b1;font-weight:600;}
    .ok {color:#158412;}
    .mismatch {color:#e13939;font-weight:700;}
    @media (max-width:950px) {
      .result-row {flex-direction:column; gap:20px;}
      .compare-row {flex-direction:column;}
      .tab-section {padding:0 3vw 44px 3vw;}
      .nav-btn {font-size:1em; padding:11px 8vw;}
      .result-box {padding: 18px 10px 18px 14px;}
    }
  </style>
</head>
<body>
  <div class="header">가격표(PC-모바일 비교) Tool</div>
  <div class="nav">
    <button class="nav-btn active" onclick="switchTab('tab1')">기아</button>
    <button class="nav-btn" onclick="switchTab('tab2')">현대</button>
  </div>
  <div id="tab1" class="tab-content active tab-section">
    <div class="upload-wrap">
      <input type="file" id="fileInput1" accept=".html,.htm">
      <button class="extract-btn" onclick="extract1()" id="extractBtn1" disabled>사양 추출</button>
    </div>
    <div class="result-row">
      <div class="result-box">
        <button class="copy-btn" onclick="copyResult1('pcResult1')">복사</button>
        <h3>PC 결과</h3>
        <div id="pcResult1" style="margin-top:6px;">PC 결과 영역</div>
      </div>
      <div class="result-box">
        <button class="copy-btn" onclick="copyResult1('moResult1')">복사</button>
        <h3>모바일 결과</h3>
        <div id="moResult1" style="margin-top:6px;">모바일 결과 영역</div>
      </div>
    </div>
    <div class="result-box compare-row">
      <div class="compare-title">PC-모바일 항목 비교</div>
      <div id="compareResult1">추출 후 자동 비교 결과 표시</div>
    </div>
    <script>
      let htmlContent1 = "";
      document.getElementById('fileInput1').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(evt) {
          htmlContent1 = evt.target.result;
          document.getElementById('extractBtn1').disabled = false;
        }
        reader.readAsText(file, 'UTF-8');
      });
      function extract1() {
        if (!htmlContent1) return;
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlContent1, "text/html");
        const pcResults = [];
        const moResults = [];
        let pcCompareMap = {}, moCompareMap = {};

        // --- PC 추출
        doc.querySelectorAll("div.price_list__item").forEach(section => {
          const trimTag = section.querySelector("h3.price_list__item-title, p.price_list__item-title");
          const trim = trimTag ? trimTag.textContent.trim().replace(/\s+/g, ' ') : '';
          if (!trim) return;
          let output = `▶ ${trim}\n[기본품목]\n`;
          let specList = [];
          section.querySelectorAll("div.item_wrap").forEach(wrap => {
            const category = wrap.querySelector(".item_tit")?.textContent.trim() ?? '';
            if (category) output += `•${category}\n`;
            wrap.querySelectorAll("a").forEach(a => {
              const name = a.textContent.trim();
              if (name) {
                output += name + "\n";
                specList.push(name);
              }
            });
          });
          const optionSet = new Set();
          section.querySelectorAll("td:nth-of-type(3) li a, .accor_con__list li a").forEach(a => {
            const name = a.textContent.trim();
            if (name) {
              optionSet.add(name);
              specList.push(name);
            }
          });
          if (optionSet.size > 0) {
            output += `[선택품목]\n`;
            optionSet.forEach(opt => output += opt + "\n");
          }
          pcResults.push(output);
          pcCompareMap[trim] = specList;
        });

        // --- 모바일 추출
        doc.querySelectorAll(".vicle-price__tabpannel").forEach(panel => {
          const trim = panel.querySelector("caption .vicle-cation-price")?.textContent.trim();
          if (!trim) return;
          let output = `▶ ${trim}\n[기본품목]\n`;
          let specList = [];
          panel.querySelectorAll(".accordion__list > li").forEach(li => {
            const cat = li.querySelector("button")?.textContent.trim();
            if (!cat || cat.includes("선택 품목") || cat === "기아 순정 액세서리") return;
            output += `•${cat}\n`;
            li.querySelectorAll("li a").forEach(a => {
              const name = a.textContent.trim();
              if (name) {
                output += name + "\n";
                specList.push(name);
              }
            });
          });
          const moOptionSet = new Set();
          panel.querySelectorAll("table a[data-modal-id], .accor_con__list li a").forEach(a => {
            const name = a.textContent.trim();
            if (name) {
              moOptionSet.add(name);
              specList.push(name);
            }
          });
          if (moOptionSet.size > 0) {
            output += `[선택품목]\n`;
            moOptionSet.forEach(opt => output += opt + "\n");
          }
          moResults.push(output);
          moCompareMap[trim] = specList;
        });

        document.getElementById("pcResult1").innerText = pcResults.join("\n");
        document.getElementById("moResult1").innerText = moResults.join("\n");

        // === PC-모바일 비교 ===
        let compareHTML = '';
        const trimKeys = Array.from(new Set([...Object.keys(pcCompareMap), ...Object.keys(moCompareMap)]));
        trimKeys.forEach(trim => {
          compareHTML += `<div style="font-weight:600;font-size:1.12em;margin:12px 0 7px 0;color:#174ac2;">▶ ${trim}</div>`;
          const pcList = Array.from(new Set(pcCompareMap[trim] || []));
          const moList = Array.from(new Set(moCompareMap[trim] || []));
          let allItems = Array.from(new Set([...pcList, ...moList]));
          let rows = '';
          allItems.forEach(item => {
            const inPC = pcList.includes(item);
            const inMO = moList.includes(item);
            if (inPC && inMO) {
              rows += `<div class="ok">✔️ ${item}</div>`;
            } else if (inPC) {
              rows += `<div class="diff">PC만 있음: ${item}</div>`;
            } else {
              rows += `<div class="plus">모바일만 있음: ${item}</div>`;
            }
          });
          if (!rows) rows = `<div style="color:#aaa">- 비교할 항목 없음 -</div>`;
          compareHTML += `<div style="margin-left:16px;">${rows}</div>`;
        });
        document.getElementById('compareResult1').innerHTML = compareHTML;
      }
      function copyResult1(id) {
        const text = document.getElementById(id).innerText;
        navigator.clipboard.writeText(text).then(() => alert("복사 완료!"));
      }
    </script>
  </div>
  <div id="tab2" class="tab-content tab-section">
    <div class="upload-wrap">
      <input type="file" id="fileInput2" accept=".html,.htm">
      <button class="extract-btn" onclick="extractCompare2()" id="extractBtn2" disabled>사양 추출</button>
    </div>
    <div class="result-row">
      <div class="result-box">
        <button class="copy-btn" onclick="copyText2('pcAllText2')">복사</button>
        <h3>PC 결과</h3>
        <div id="pcAllText2" style="margin-top:6px;">PC 결과 영역</div>
      </div>
      <div class="result-box">
        <button class="copy-btn" onclick="copyText2('moAllText2')">복사</button>
        <h3>모바일 결과</h3>
        <div id="moAllText2" style="margin-top:6px;">모바일 결과 영역</div>
      </div>
    </div>
    <div class="result-box compare-row">
      <div class="compare-title">PC-모바일 항목 비교</div>
      <div id="compareResult2">추출 후 자동 비교 결과 표시</div>
    </div>
    <script>
      let htmlContent2 = "";
      document.getElementById('fileInput2').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(evt) {
          htmlContent2 = evt.target.result;
          document.getElementById('extractBtn2').disabled = false;
        }
        reader.readAsText(file, 'UTF-8');
      });

      function normalize(str) {
        return (str||"").replace(/\s+/g, '').replace(/[^\w가-힣]/g,'').toLowerCase();
      }

      function extractCompare2() {
        if (!htmlContent2) return;
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlContent2, "text/html");
        const {pcTrims, allText: pcAllText, pcSpecMap} = extractPC2(doc);
        const {moTrims, allText: moAllText, moSpecMap} = extractMO2(doc);
        document.getElementById("pcAllText2").innerText = pcAllText || "PC 결과 없음";
        document.getElementById("moAllText2").innerText = moAllText || "모바일 결과 없음";
        // === PC-모바일 비교 ===
        let compareHTML = '';
        const trimKeys = Array.from(new Set([...Object.keys(pcSpecMap), ...Object.keys(moSpecMap)]));
        trimKeys.forEach(trim => {
          compareHTML += `<div style="font-weight:600;font-size:1.12em;margin:12px 0 7px 0;color:#174ac2;">▶ ${trim}</div>`;
          const pcList = Array.from(new Set(pcSpecMap[trim] || []));
          const moList = Array.from(new Set(moSpecMap[trim] || []));
          // 1. 정규화해서 매칭 가능한 쌍 생성(문구가 비슷한데 공백/기호만 다른 케이스 체크)
          let matched = new Set();
          let moNormalized = moList.map(x=>normalize(x));
          let pcNormalized = pcList.map(x=>normalize(x));
          // 완전일치(문구)
          let both = [];
          pcList.forEach((pcItem, idx) => {
            let n = normalize(pcItem);
            let moIdx = moNormalized.indexOf(n);
            if(moIdx !== -1) {
              both.push({pc:pcItem, mo:moList[moIdx], match:true});
              matched.add(moList[moIdx]);
            }
          });
          // 불일치(텍스트 다름)
          pcList.forEach((pcItem, idx) => {
            let n = normalize(pcItem);
            let moIdx = moNormalized.indexOf(n);
            if(moIdx === -1) {
              // PC 기준으로 비슷한 항목 찾기(문자길이 유사, 70% 이상 공통문자 등)
              let found = false;
              moList.forEach(moItem => {
                if (matched.has(moItem)) return;
                if (pcItem && moItem && (pcItem.includes(moItem) || moItem.includes(pcItem))) {
                  compareHTML += `<div class="mismatch">불일치(PC: ${pcItem} / 모바일: ${moItem})</div>`;
                  matched.add(moItem); found = true;
                }
              });
              if(!found && !matched.has(pcItem)) compareHTML += `<div class="diff">PC만 있음: ${pcItem}</div>`;
            }
          });
          // 모바일만 있는 것
          moList.forEach((moItem, idx) => {
            let n = normalize(moItem);
            let pcIdx = pcNormalized.indexOf(n);
            if(pcIdx === -1 && !matched.has(moItem)) {
              // PC쪽과 비슷한 항목이 없는 경우에만
              compareHTML += `<div class="plus">모바일만 있음: ${moItem}</div>`;
            }
          });
          // 완전일치
          both.forEach(({pc, mo}) => {
            if (pc === mo) {
              compareHTML += `<div class="ok">✔️ ${pc}</div>`;
            } else {
              compareHTML += `<div class="mismatch">불일치(PC: ${pc} / 모바일: ${mo})</div>`;
            }
          });
          compareHTML += `<hr style="border:none;border-top:1px dashed #e3e3e3;margin:10px 0 10px 0;">`;
        });
        document.getElementById('compareResult2').innerHTML = compareHTML;
      }
      function extractPC2(doc) {
        const pcTrims = {}, pcSpecMap = {};
        let allText = '';
        doc.querySelectorAll('#price-table tr[data-trim]').forEach(tr => {
          const en = tr.querySelector('.table-price-title .en')?.textContent.trim() ?? '';
          const kr = tr.querySelector('.table-price-title .kr')?.textContent.trim() ?? '';
          const trimKey = en || kr || tr.getAttribute('data-trim');
          let result = `[${trimKey}]\n`;
          let specList = [];
          tr.querySelectorAll('.table-price-title .price').forEach(el => {
            let desc = el.previousSibling;
            while (desc && desc.nodeType !== 1 && desc.nodeType !== 3) desc = desc.previousSibling;
            let label = '';
            if (desc && desc.textContent) label = desc.textContent.replace(/[\n\r]+/g,'').replace(/<br>/g,' ').trim();
            result += label ? `${label}: ${el.textContent.trim()}\n` : `${el.textContent.trim()}\n`;
          });
          tr.querySelectorAll('ul[data-opts="basic"]').forEach(ul => {
            ul.querySelectorAll('li').forEach(li => {
              const cat = li.querySelector('.name')?.textContent.trim() ?? '';
              const opts = Array.from(li.querySelectorAll('.spec_opts')).map(x => x.textContent.trim());
              if (cat) result += `•${cat}\n`;
              opts.forEach(opt => { if (opt) { result += `  - ${opt}\n`; specList.push(opt);} });
            });
          });
          tr.querySelectorAll('.table-acodian-list ul[data-opts="select"]').forEach(ul => {
            ul.querySelectorAll('li').forEach(li => {
              const name = li.querySelector('.item-name')?.textContent.trim() ?? '';
              const price = li.querySelector('.item-price')?.textContent.trim() ?? '';
              if(name) {
                result += `  - ${name}${price ? ` (${price})` : ''}\n`;
                specList.push(name);
              }
            });
          });
          result += '\n';
          pcTrims[trimKey] = {};
          allText += result;
          pcSpecMap[trimKey] = specList;
        });
        return { pcTrims, allText: allText.trim(), pcSpecMap };
      }
      function extractMO2(doc) {
        const moTrims = {}, moSpecMap = {};
        let allText = '';
        doc.querySelectorAll('.mob-only [data-trim]').forEach(div => {
          const en = div.querySelector('.table-price-title .en')?.textContent.trim() ??
                     div.querySelector('.floating-title .en')?.textContent.trim() ?? '';
          const kr = div.querySelector('.table-price-title .kr')?.textContent.trim() ??
                     div.querySelector('.floating-title .kr')?.textContent.trim() ?? '';
          const trimKey = en || kr || div.getAttribute('data-trim');
          let result = `[${trimKey}]\n`;
          let specList = [];
          div.querySelectorAll('.table-price-title .price').forEach(el => {
            let desc = el.previousSibling;
            while (desc && desc.nodeType !== 1 && desc.nodeType !== 3) desc = desc.previousSibling;
            let label = '';
            if (desc && desc.textContent) label = desc.textContent.replace(/[\n\r]+/g,'').replace(/<br>/g,' ').trim();
            result += label ? `${label}: ${el.textContent.trim()}\n` : `${el.textContent.trim()}\n`;
          });
          // ===== [선택품목 중복 버그 완벽 해결] =====
          // 모든 선택품목을 Set에 넣어서 중복 없이 1회만 수집
          let allSelects = new Set();
          // 기본품목
          div.querySelectorAll('ul[data-opts="basic"]').forEach(ul => {
            ul.querySelectorAll('li').forEach(li => {
              const cat = li.querySelector('button')?.textContent.trim() ?? '';
              const opts = Array.from(li.querySelectorAll('.spec_opts')).map(x => x.textContent.trim());
              if (cat) result += `•${cat}\n`;
              opts.forEach(opt => { if (opt) { result += `  - ${opt}\n`; specList.push(opt); } });
            });
          });
          // 선택품목 (중복 완전 제거)
          div.querySelectorAll('ul[data-opts="select"] li').forEach(li => {
            const name = li.querySelector('.item-name')?.textContent.trim() ?? '';
            if(name && !allSelects.has(name)) {
              allSelects.add(name);
              specList.push(name);
            }
          });
          result += '\n';
          moTrims[trimKey] = {};
          allText += result;
          moSpecMap[trimKey] = Array.from(allSelects);
        });
        return { moTrims, allText: allText.trim(), moSpecMap };
      }
      function copyText2(id) {
        const text = document.getElementById(id).innerText;
        navigator.clipboard.writeText(text).then(() => alert("복사 완료!"));
      }
    </script>
  </div>
  <script>
    function switchTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(el=>el.classList.remove('active'));
      document.querySelectorAll('.nav-btn').forEach(btn=>btn.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      const idx = (tabId === "tab1") ? 0 : 1;
      document.querySelectorAll('.nav-btn')[idx].classList.add('active');
    }
  </script>
</body>
</html>
